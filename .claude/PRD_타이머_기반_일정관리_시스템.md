# PRD: 타이머 기반 일정관리 시스템

> **Version:** 1.1  
> **최종 수정일:** 2026-02-01  

---

## 1. 개요

본 프로젝트는 사용자가 직접 정의한 항목(태스크)에 타이머를 설정하고, 설정된 시간이 경과하면 알림을 통해 인지시키며, 누적된 타이머 데이터를 기반으로 항목별 시간 통계를 제공하는 일정관리 시스템이다.

---

## 2. 목표 사용자

개인 시간 관리가 필요한 사용자로, 업무·학습·운동 등 다양한 활동에 시간을 할당하고 그 결과를 되돌아보고자 하는 사람을 대상으로 한다.

---

## 3. 핵심 기능 요구사항

### 3.1 항목(태스크) 관리

사용자는 타이머를 적용할 항목을 직접 생성, 수정, 삭제할 수 있어야 한다. 각 항목은 다음 속성을 포함한다.

- **항목 이름** (필수, 중복 불가)
- **항목 설명** (선택)
- **카테고리 또는 태그** (선택, 통계 그룹핑 용도)
- **생성일시**
- **활성/비활성 상태**

### 3.2 타이머

각 항목에 대해 타이머를 설정하고 제어할 수 있어야 한다.

**타이머 설정:** 사용자가 원하는 시간(시/분/초)을 직접 입력하여 카운트다운 타이머를 설정한다. 프리셋(예: 25분, 50분 등)도 제공하되 커스텀 입력을 기본으로 한다.

**타이머 제어:** 시작, 일시정지, 재개, 초기화 기능을 제공한다. 타이머가 동작 중인 항목은 시각적으로 구분되어야 한다.

**동시 실행 정책:** 한 시점에 하나의 타이머만 활성화된다. 다른 항목의 타이머를 시작하면 현재 동작 중인 타이머는 자동으로 일시정지되며, 해당 시점까지의 경과 시간은 기록에 반영된다.

### 3.3 알림

타이머가 설정된 시간에 도달하면 사용자에게 알림을 제공한다.

**팝업 알림:** 브라우저 Notification API를 활용한 시스템 알림을 기본으로 하며, 앱 내 모달/토스트 알림을 병행한다.

**사운드 알림:** 타이머 완료 시 알림음을 재생한다. 사용자는 알림음 on/off 및 볼륨을 설정할 수 있어야 한다.

**알림 설정:** 사용자가 알림 방식(팝업만, 사운드만, 둘 다)을 선택할 수 있도록 한다.

**백그라운드 탭 알림:** 사용자가 다른 브라우저 탭을 보고 있거나 브라우저가 포커스를 잃은 상태에서도 타이머 완료 알림이 정상적으로 표시되어야 한다. 이를 위해 다음 기술을 적용한다.

- **Service Worker:** 백그라운드에서 타이머 만료를 감지하고 시스템 알림을 발행한다. 탭이 비활성 상태일 때 `setTimeout`/`setInterval`이 쓰로틀링되는 브라우저 제약을 우회한다.
- **Web Worker (보조):** 타이머 카운트다운 연산을 메인 스레드와 분리하여 탭 비활성 시에도 정확한 시간 계산을 유지한다.
- **Notification API 권한:** 앱 최초 로드 시 사용자에게 시스템 알림 권한을 요청하며, 권한이 거부된 경우 앱 내 알림(토스트)으로 대체하고 권한 재요청 안내를 표시한다.
- **타이틀 표시:** 타이머 동작 중 브라우저 탭 타이틀에 남은 시간을 표시하여 다른 탭에서도 잔여 시간을 확인할 수 있도록 한다 (예: `⏱ 04:32 - 독서`).

### 3.4 시간 통계

타이머가 동작한 시간을 항목별로 누적 기록하고, 기간별 통계를 제공한다.

**기록 데이터:** 각 타이머 세션은 항목 ID, 시작 시각, 종료 시각, 경과 시간을 저장한다.

**통계 조회 기간:** 일별, 주별, 월별, 사용자 지정 기간(시작일~종료일)을 지원한다.

**통계 표시 항목:** 항목별 총 소요 시간 합계, 전체 항목 대비 비율(%), 기간 내 일별 추이 그래프를 제공한다.

**시각화:** 막대 차트(항목별 비교), 파이 차트(비율), 라인 차트(추이) 중 적절한 형태로 표현한다.

---

## 4. 비기능 요구사항

**데이터 정합성:** 모킹 데이터를 사용하지 않으며, 모든 데이터는 실제 사용자 입력 및 타이머 동작으로부터 생성된 실데이터만 활용한다. DB에 저장된 데이터를 기반으로 통계를 산출한다.

**코드 품질:** Kotlin 백엔드 코드 전체에 한국어 주석을 포함하여 각 클래스, 메서드, 주요 로직의 의도를 명시한다.

**응답 성능:** 타이머 시작/정지 등 실시간 제어 API는 200ms 이내 응답을 목표로 한다.

**브라우저 호환:** Chrome, Edge, Safari 최신 2개 버전을 지원한다.

---

## 5. 기술 스택

### 5.1 백엔드 — Kotlin

- **프레임워크:** Spring Boot
- **빌드 도구:** Gradle (Kotlin DSL)
- **데이터베이스:** PostgreSQL
- **ORM:** Spring Data JPA
- **API 형식:** RESTful JSON API

### 5.2 프론트엔드 — React

- **언어:** TypeScript
- **상태 관리:** React 내장 훅 (useState, useContext) 또는 Zustand
- **HTTP 통신:** Axios 또는 Fetch API
- **차트 라이브러리:** Recharts 또는 Chart.js
- **알림:** Browser Notification API + Service Worker + Web Audio API
- **백그라운드 처리:** Web Worker (타이머 연산), Service Worker (알림 발행)
- **스타일링:** Tailwind CSS 또는 Styled Components

### 5.3 배포 — Docker

- **컨테이너 구성:** Docker Compose를 사용하여 백엔드(Spring Boot), 프론트엔드(Nginx + React 빌드), 데이터베이스(PostgreSQL) 컨테이너를 통합 관리한다.
- **이미지 빌드:** 멀티스테이지 빌드를 적용하여 최종 이미지 크기를 최소화한다.
- **환경 변수:** DB 접속 정보, 서버 포트 등 환경별 설정은 `.env` 파일 및 Docker Compose 환경 변수로 관리한다.
- **데이터 영속성:** PostgreSQL 데이터는 Docker Volume을 통해 컨테이너 재시작 시에도 유지한다.
- **실행:** `docker-compose up -d` 단일 명령으로 전체 시스템을 기동할 수 있어야 한다.

---

## 6. Docker 컨테이너 구성

```
┌─────────────────────────────────────────────────┐
│  docker-compose.yml                             │
│                                                 │
│  ┌──────────┐  ┌──────────┐  ┌──────────────┐  │
│  │ frontend │  │ backend  │  │  database     │  │
│  │ (Nginx)  │→ │ (Spring  │→ │ (PostgreSQL)  │  │
│  │ :80      │  │  Boot)   │  │  :5432        │  │
│  │          │  │  :8080   │  │               │  │
│  └──────────┘  └──────────┘  └──────┬────────┘  │
│                                     │ volume     │
│                               ┌─────┴─────┐     │
│                               │  pgdata   │     │
│                               └───────────┘     │
└─────────────────────────────────────────────────┘
```

| 서비스 | 이미지 베이스 | 포트 | 설명 |
|--------|-------------|------|------|
| frontend | node → nginx:alpine (멀티스테이지) | 80 | React 빌드 결과를 Nginx로 서빙, /api 경로를 backend로 리버스 프록시 |
| backend | eclipse-temurin:21-jdk → jre (멀티스테이지) | 8080 | Spring Boot API 서버 |
| database | postgres:16-alpine | 5432 | PostgreSQL, Volume 마운트로 데이터 영속 |

---

## 7. 주요 API 설계 (초안)

### 항목 관리

| 메서드 | 엔드포인트 | 설명 |
|--------|-----------|------|
| POST | /api/tasks | 항목 생성 |
| GET | /api/tasks | 항목 목록 조회 |
| PUT | /api/tasks/{id} | 항목 수정 |
| DELETE | /api/tasks/{id} | 항목 삭제 |

### 타이머 제어

| 메서드 | 엔드포인트 | 설명 |
|--------|-----------|------|
| POST | /api/timer/start | 타이머 시작 (taskId, duration 포함) |
| POST | /api/timer/pause | 타이머 일시정지 |
| POST | /api/timer/resume | 타이머 재개 |
| POST | /api/timer/stop | 타이머 종료 및 세션 기록 저장 |

### 통계 조회

| 메서드 | 엔드포인트 | 설명 |
|--------|-----------|------|
| GET | /api/stats?period=daily&date=2026-02-01 | 일별 통계 |
| GET | /api/stats?period=weekly&date=2026-02-01 | 주별 통계 |
| GET | /api/stats?period=monthly&date=2026-02 | 월별 통계 |
| GET | /api/stats?from=...&to=... | 사용자 지정 기간 통계 |

---

## 8. 데이터 모델 (초안)

### Task (항목)

| 필드 | 타입 | 설명 |
|------|------|------|
| id | Long (PK) | 고유 식별자 |
| name | String | 항목 이름 (Unique) |
| description | String? | 항목 설명 |
| category | String? | 카테고리/태그 |
| isActive | Boolean | 활성 상태 |
| createdAt | LocalDateTime | 생성일시 |
| updatedAt | LocalDateTime | 수정일시 |

### TimerSession (타이머 세션 기록)

| 필드 | 타입 | 설명 |
|------|------|------|
| id | Long (PK) | 고유 식별자 |
| taskId | Long (FK) | 연결된 항목 |
| duration | Long | 설정된 시간 (초) |
| elapsed | Long | 실제 경과 시간 (초) |
| startedAt | LocalDateTime | 시작 시각 |
| endedAt | LocalDateTime? | 종료 시각 |
| status | Enum | RUNNING, PAUSED, COMPLETED, CANCELLED |

---

## 9. 화면 구성 (주요 뷰)

**메인 대시보드:** 등록된 항목 목록과 각 항목의 타이머 제어 UI를 표시한다. 현재 동작 중인 타이머가 상단에 강조 표시된다.

**항목 관리 화면:** 항목 CRUD를 수행하는 폼 화면이다.

**통계 화면:** 기간 선택 UI와 함께 차트 및 테이블 형태로 항목별 시간 통계를 표시한다.

**설정 화면:** 알림 방식, 알림음, 기본 타이머 프리셋 등을 설정한다.

---

## 10. 마일스톤

| 단계 | 내용 | 산출물 |
|------|------|--------|
| M1 | Docker 환경 구성 + 항목 CRUD + 기본 타이머 동작 (백엔드 API + 프론트 연동) | `docker-compose up`으로 기동 가능한 MVP |
| M2 | 알림 기능 구현 (Service Worker + Notification API + 사운드) + 백그라운드 탭 알림 | 탭 비활성 상태에서도 알림 동작 확인 |
| M3 | 타이머 세션 기록 저장 + 통계 API + 통계 화면 | 기간별 통계 조회 가능 |
| M4 | UI 폴리싱, 설정 화면, 엣지 케이스 처리, 배포 최적화 | 프로덕션 배포 가능한 v1.0 |

---

## 부록: 백그라운드 알림 기술 상세

### 브라우저 제약과 해결 전략

브라우저는 비활성 탭의 `setTimeout`/`setInterval`을 최소 1초 간격으로 쓰로틀링하며, 일부 브라우저는 5분 이상 비활성 시 타이머를 동결한다. 이를 해결하기 위해 다음 전략을 적용한다.

**Web Worker 기반 타이머:** 타이머 카운트다운 로직을 Web Worker 내에서 실행한다. Web Worker는 메인 스레드와 독립적이므로 탭 비활성 쓰로틀링의 영향을 받지 않는다. Worker는 매 초 `postMessage`로 남은 시간을 메인 스레드에 전달하고, 만료 시 알림 트리거 메시지를 전송한다.

**Service Worker 알림:** 등록된 Service Worker가 `showNotification()`을 통해 OS 수준의 시스템 알림을 표시한다. 이 알림은 브라우저가 백그라운드에 있어도 표시되며, 사용자가 알림을 클릭하면 해당 탭으로 포커스를 이동시킨다.

**서버 타임스탬프 기반 보정:** 타이머 시작 시 서버에 시작 시각과 만료 예정 시각을 기록한다. 클라이언트가 다시 활성화되면 서버 시간과 비교하여 타이머 상태를 보정한다. 이를 통해 브라우저 종료 후 재접속 시에도 정확한 상태를 복원할 수 있다.
